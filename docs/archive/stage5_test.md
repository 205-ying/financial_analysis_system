# 阶段五验收测试

## 测试环境准备

### 1. 启动后端服务

```bash
cd backend
# Windows
start_dev.bat

# Linux/Mac
./start_dev.sh
```

后端服务地址: `http://localhost:8000`

### 2. 安装前端依赖

```bash
cd frontend
npm install
```

### 3. 启动前端开发服务器

```bash
npm run dev
```

前端服务地址: `http://localhost:5173`

---

## 测试用例

### 测试 1: 登录功能

**步骤:**
1. 访问 `http://localhost:5173`
2. 自动跳转到 `/login`
3. 输入用户名: `admin`，密码: `Admin@123`
4. 点击"登录"按钮

**预期结果:**
- ✅ 显示"登录成功"提示
- ✅ 跳转到首页（看板页面）
- ✅ 顶部栏显示用户名"admin"
- ✅ 侧边栏显示所有菜单：看板、订单管理、费用管理、KPI 分析、审计日志

---

### 测试 2: Token 持久化

**步骤:**
1. 完成测试 1 登录
2. 刷新页面（F5）

**预期结果:**
- ✅ 保持登录状态，不跳转登录页
- ✅ 用户信息和菜单正常显示
- ✅ 浏览器 localStorage 中存在 `auth` 键

---

### 测试 3: 权限路由（超级管理员）

**步骤:**
1. 以 `admin` 身份登录
2. 依次点击侧边栏菜单：看板、订单管理、费用管理、KPI 分析、审计日志

**预期结果:**
- ✅ 所有菜单项都可见
- ✅ 点击后正常跳转，显示对应页面
- ✅ 面包屑显示当前路径
- ✅ URL 地址栏正常更新

---

### 测试 4: 权限路由（普通管理员）

**步骤:**
1. 退出当前登录（点击顶部栏用户名 -> 退出登录 -> 确定）
2. 使用 `manager` / `Manager@123` 登录
3. 查看侧边栏菜单

**预期结果:**
- ✅ 根据权限显示菜单（manager 账号的权限由后端数据决定）
- ✅ 无权限的菜单不显示

---

### 测试 5: 无权限拦截

**步骤:**
1. 以 `manager` 身份登录（假设无 audit:view 权限）
2. 在浏览器地址栏手动输入 `http://localhost:5173/audit-logs`
3. 按回车访问

**预期结果:**
- ✅ 跳转到 `/403` 无权限页面
- ✅ 显示"抱歉，您无权访问此页面"
- ✅ 可以点击"返回上一页"或"返回首页"

---

### 测试 6: 侧边栏折叠

**步骤:**
1. 点击顶部栏左侧的折叠图标（三横线图标）
2. 再次点击

**预期结果:**
- ✅ 第一次点击：侧边栏折叠，只显示图标
- ✅ 第二次点击：侧边栏展开，显示图标和文字
- ✅ 内容区宽度自动调整
- ✅ 动画过渡流畅

---

### 测试 7: 面包屑导航

**步骤:**
1. 依次点击侧边栏菜单：订单管理 -> 费用管理 -> KPI 分析
2. 观察顶部栏面包屑

**预期结果:**
- ✅ 面包屑显示当前页面名称
- ✅ 点击面包屑可以跳转（如果有多级）

---

### 测试 8: 退出登录

**步骤:**
1. 点击顶部栏用户名下拉菜单
2. 点击"退出登录"
3. 在确认对话框中点击"确定"

**预期结果:**
- ✅ 显示确认对话框
- ✅ 确认后跳转到登录页
- ✅ localStorage 中的 token 被清除
- ✅ 尝试访问任何页面都会跳转登录页

---

### 测试 9: 后端 401 自动跳转

**步骤:**
1. 登录成功后，打开浏览器开发者工具（F12）
2. 切换到 Application/Storage -> Local Storage
3. 找到并删除 `auth` 键
4. 刷新页面或点击任意菜单

**预期结果:**
- ✅ 自动跳转到登录页
- ✅ 显示错误提示："认证令牌无效或已过期"

---

### 测试 10: 404 页面

**步骤:**
1. 在浏览器地址栏输入 `http://localhost:5173/not-exist-page`
2. 按回车访问

**预期结果:**
- ✅ 跳转到 `/404` 页面
- ✅ 显示"抱歉，您访问的页面不存在"
- ✅ 可以点击"返回上一页"或"返回首页"

---

### 测试 11: 表单验证

**步骤:**
1. 访问登录页
2. 不输入任何内容，直接点击"登录"
3. 输入用户名 `a`，密码 `12345`，点击"登录"

**预期结果:**
- ✅ 第一次点击：显示"请输入用户名"和"请输入密码"验证提示
- ✅ 第二次点击：显示"用户名长度必须在 2 到 50 个字符之间"和"密码长度必须在 6 到 50 个字符之间"

---

### 测试 12: 登录失败

**步骤:**
1. 访问登录页
2. 输入用户名 `admin`，密码 `wrongpassword`
3. 点击"登录"

**预期结果:**
- ✅ 显示错误提示："用户名或密码错误"
- ✅ 不跳转页面，停留在登录页

---

### 测试 13: Enter 键登录

**步骤:**
1. 访问登录页
2. 输入用户名 `admin`，密码 `Admin@123`
3. 按 Enter 键

**预期结果:**
- ✅ 触发登录，效果与点击"登录"按钮相同
- ✅ 登录成功后跳转首页

---

### 测试 14: Redirect 参数

**步骤:**
1. 未登录状态下，在浏览器地址栏输入 `http://localhost:5173/orders`
2. 按回车访问

**预期结果:**
- ✅ 跳转到登录页，URL 为 `/login?redirect=/orders`
- ✅ 登录成功后自动跳转到 `/orders` 页面

---

## 验收标准

| 测试用例 | 状态 | 备注 |
|---------|------|------|
| 测试 1: 登录功能 | ⬜ 通过 / ⬜ 失败 | |
| 测试 2: Token 持久化 | ⬜ 通过 / ⬜ 失败 | |
| 测试 3: 权限路由（超管） | ⬜ 通过 / ⬜ 失败 | |
| 测试 4: 权限路由（普管） | ⬜ 通过 / ⬜ 失败 | |
| 测试 5: 无权限拦截 | ⬜ 通过 / ⬜ 失败 | |
| 测试 6: 侧边栏折叠 | ⬜ 通过 / ⬜ 失败 | |
| 测试 7: 面包屑导航 | ⬜ 通过 / ⬜ 失败 | |
| 测试 8: 退出登录 | ⬜ 通过 / ⬜ 失败 | |
| 测试 9: 后端 401 自动跳转 | ⬜ 通过 / ⬜ 失败 | |
| 测试 10: 404 页面 | ⬜ 通过 / ⬜ 失败 | |
| 测试 11: 表单验证 | ⬜ 通过 / ⬜ 失败 | |
| 测试 12: 登录失败 | ⬜ 通过 / ⬜ 失败 | |
| 测试 13: Enter 键登录 | ⬜ 通过 / ⬜ 失败 | |
| 测试 14: Redirect 参数 | ⬜ 通过 / ⬜ 失败 | |

**通过条件:** 所有测试用例通过

---

## 常见问题排查

### 前端无法启动
```bash
# 清除依赖重新安装
rm -rf node_modules package-lock.json
npm install
```

### 后端连接失败
- 检查后端服务是否正常运行: `http://localhost:8000/docs`
- 检查 `.env.development` 中的 `VITE_API_BASE_URL` 配置

### 登录后看不到菜单
- 检查后端返回的 `permissions` 字段
- 打开浏览器开发者工具，查看 localStorage -> auth -> permissions

### 权限拦截不生效
- 检查路由守卫是否正确执行
- 查看浏览器控制台是否有错误日志

---

## 验收完成

测试人: ______________

测试日期: ______________

测试结果: ⬜ 通过 / ⬜ 不通过

备注: 
_______________________________________________
_______________________________________________
_______________________________________________
